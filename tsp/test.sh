#!/usr/bin/env bash
set -e

# === CLEANUP ON EXIT ===
# This will remove any test*.txt when the script exits for any reason.
trap 'rm -f test*.txt' EXIT

# 1) Compile
gcc -Wall -Wextra -std=c11 tsp.c -lm -o tsp

# 2) Generate test inputs
cat >test1.txt <<EOF
-6.15704, 2.20589
EOF

cat >test2.txt <<EOF
-14.80580, -0.00004
-30.67030, -2.02336
EOF

cat >test3.txt <<EOF
12.52090, -13.36490
-46.39660, -9.17876
-34.70180, 13.49000
EOF

cat >test4.txt <<EOF
-8.02244, -1.35290
-27.96270, -17.05770
-0.00003, -0.00002
9.95119, -6.27887
EOF

cat >test5.txt <<EOF
-45.67550, -9.74380
23.45678, 15.12345
-12.34567, 8.76543
5.67891, -4.32109
-29.87654, 27.65432
EOF

cat >test6.txt <<EOF
0.00012, -0.00047
35.79123, -42.13579
-7.02468, 19.13579
14.27183, -28.31415
-3.16180, 9.26535
8.18527, -16.46264
EOF

cat >test7.txt <<EOF
-2.71828, 3.14159
1.41421, -1.73205
6.02214, -0.57721
-9.10938, 2.30258
4.66920, -1.61803
-5.55116, 0.69314
2.50290, -4.66920
EOF

cat >test8.txt <<EOF
7.38906, -8.18527
-1.41421, 2.23607
3.16228, -5.19615
-6.28318, 9.42477
0.57721, -1.73205
-4.66920, 2.50290
9.86960, -3.14159
-2.64575, 3.60555
EOF

cat >test9.txt <<EOF
10.00000, -10.00000
-9.00000, 9.00000
8.00000, -8.00000
-7.00000, 7.00000
6.00000, -6.00000
-5.00000, 5.00000
4.00000, -4.00000
-3.00000, 3.00000
2.00000, -2.00000
EOF

cat >test10.txt <<EOF
0.12345, -0.54321
11.11111, -11.11111
-22.22222, 22.22222
33.33333, -33.33333
-44.44444, 44.44444
55.55555, -55.55555
-66.66666, 66.66666
77.77777, -77.77777
-88.88888, 88.88888
99.99999, -99.99999
EOF

cat >test11.txt <<EOF
-6.15704, 2.20589
-14.80580, -0.00004
-30.67030, -2.02336
12.52090, -13.36490
-46.39660, -9.17876
-34.70180, 13.49000
-8.02244, -1.35290
-27.96270, -17.05770
-0.00003, -0.00002
9.95119, -6.27887
-45.67550, -9.74380
EOF

cat >test12.txt <<EOF
3.21098, -4.56789
-7.89012, 1.23456
2.46802, -9.75310
6.54321, -0.12345
-5.43210, 8.76543
EOF

cat >test13.txt <<EOF
0.10203, -0.30405
0.50607, -0.80901
-0.11213, 0.14151
-0.61718, 0.19121
0.71828, -0.18281
-0.18281, 0.27182
EOF

cat >test14.txt <<EOF
-10.00000, 10.00000
-5.00000, 5.00000
0.00000, 0.00000
5.00000, -5.00000
EOF

cat >test15.txt <<EOF
2.50000, -1.25000
5.00000, -2.50000
7.50000, -3.75000
EOF

# 3) Expected results
expected=(
  "0.00" "31.99" "138.90" "84.70" "180.72"
  "152.42" "35.81" "50.17" "53.74" "534.26"
  "154.85" "48.73" "3.66" "42.43" "11.18"
)

echo
echo "=== Running & Validating TSP tests ==="
for i in $(seq 1 15); do
  echo -n "--- Test $i: "

  out=$(./tsp <test${i}.txt)
  exp=${expected[$((i - 1))]}

  # absolute difference
  diff=$(echo "$out - $exp" | bc -l | awk '{ d=$1<0?-1*$1:$1; printf("%.5f",d) }')
  ok=$(echo "$diff < 0.01" | bc -l)

  if [ "$ok" -eq 1 ]; then
    echo "PASS (got $out, expected $exp)"
  else
    echo "FAIL (got $out, expected $exp, Δ=$diff)"
  fi
done

# (No explicit rm needed here— the trap at top will clean up all test*.txt)
